---
name: generate-registry
on:
  push:
    branches: [main]
jobs:
  generate-registry:
    name: generate-registry
    runs-on: ubuntu-latest
    steps:
      - name: Check out code from GitHub
        uses: actions/checkout@v3
        with:
          ref: ${{ github.ref_name }}
      - name: Run generate-registry
        id: generate_registry
        run: |
          ./generate-registry.sh
          echo "::set-output name=diff_lines::$(git diff registry.yaml | wc -l)"
      - name: commit and push registry.yaml
        if: steps.generate_registry.outputs.diff_lines != '0'
        env:
          BRANCH: ${{ github.ref_name }}
        run: |
          git config user.name 'github-actions[bot]'
          git config user.email 'github-actions[bot]@users.noreply.github.com'
          git add registry.yaml
          git commit -m 'generated registry'
          git push origin "HEAD:$BRANCH"
