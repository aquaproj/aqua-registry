---
# the configuration file of cmdx - task runner
# https://github.com/suzuki-shunsuke/cmdx
tasks:
  - name: test
    short: t
    description: test
    usage: test
    flags:
      - name: recreate
        short: r
        type: bool
    args:
      - name: pkg
        required: true
    script: |
      set -euxo pipefail
      if [ "{{.recreate}}" = true ]; then
        cmdx rm
      fi
      bash scripts/test.sh "{{.pkg}}"
  - name: stop
    description: stop container
    usage: stop container
    script: |
      docker stop -t 1 aqua-registry
  - name: remove
    short: rm
    description: remove the container
    usage: remove the container
    script: |
      set -euxo pipefail
      docker stop -t 1 aqua-registry
      docker rm aqua-registry
  - name: connect
    short: con
    description: connect to the container
    usage: connect to the container
    args:
      - name: os
        required: true
      - name: arch
        required: true
    script: |
      set -euxo pipefail
      docker exec -ti aqua-registry env AQUA_GOOS="{{.os}}" AQUA_GOARCH="{{.arch}}" bash
  - name: release
    short: r
    description: release the new version
    usage: release the new version
    script: |
      git tag -m "chore: release {{.version}}" "{{.version}}"
      git push origin "{{.version}}"
    args:
      - name: version
        required: true
        validate:
          - regexp: "^v\\d+\\.\\d+.\\d+(-\\d+)?$"
  - name: gr
    description: aqua-registry gr
    usage: aqua-registry gr
    script: aqua-registry gr
  - name: new
    description: aqua-registry create-pr-new-pkg
    usage: aqua-registry create-pr-new-pkg
    script: aqua-registry create-pr-new-pkg "{{.package}}"
    args:
      - name: package
        required: true
  - name: scaffold
    short: s
    description: aqua-registry scaffold
    usage: aqua-registry scaffold
    flags:
      - name: recreate
        short: r
        type: bool
    script: |
      if [ "{{.recreate}}" = true ]; then
        cmdx rm
      fi
      bash scripts/scaffold.sh "{{.package}}"
    args:
      - name: package
        required: true
